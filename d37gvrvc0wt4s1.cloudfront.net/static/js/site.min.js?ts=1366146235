Rollbar.Util=BaseClass.extend({init:function(){$(document.body).ajaxError(function(d,g,b,c){var f="Network Error";var a="Error requesting: "+b.url;switch(g.status){case 403:f="Permission error";a="You're not allowed to access this resource";break}window.AlertManager.showMessage("error",f,a)})}});Rollbar.AlertManager=BaseClass.extend({init:function(a){this.$elem=a;this.$template=$(".template",this.$elem).first()},showMessage:function(e,g,a,d){var f=this.$template.clone();var b=$(".title",f);var c=$(".body",f);f.removeClass("template").addClass("alert-"+e);b.text(g);c.text(a);if(d){d.append(f)}else{this.$elem.append(f)}f.removeClass("hidden").alert()}});Rollbar.ItemStatusButton=BaseClass.extend({init:function(b){var a=this;this.$elem=b;this.$elem.each(function(){var g=$(this);var e=g.attr("data-itemstatus-url");var c=$('select.status-ids option[selected="selected"]',g);var f=g.attr("data-itemstatus-refreshsearch")==1;var d=function(h){a.updateButtonUi(g,h)};g.click(function(i){var h=g.attr("data-itemstatus-currentstatus");var j={active:"resolved",resolved:"active",muted:"active"}[h];var k=[];c.each(function(){k.push($(this).val())});c.remove();var l=function(n){if(f){$("form#search-form button[type=submit]").click()}else{var m=n.status;d(m)}};i.preventDefault();$.ajax({type:"POST",url:e,data:{new_status:j,item:k},success:l,dataType:"json"})})});this.$elem.bind("item_status_change",function(d,f,e){var c=$(d.target);if(c.is(".item-status-button")){a.updateButtonUi(c,e)}else{if(c.is(".item-status-label[data-itemid="+f+"]")){a.updateLabelUi(c,e)}}d.preventDefault()})},updateButtonUi:function(b,a){b.attr("data-itemstatus-currentstatus",a);if(a=="active"){b.removeClass("btn-danger").addClass("btn-success").text("Resolve")}else{if(a=="resolved"){b.removeClass("btn-success").addClass("btn-danger").text("Reopen")}else{if(a=="muted"){b.removeClass("btn-success").text("Unmute")}else{this.log("unknown status, "+a)}}}},updateLabelUi:function(a,b){a.text(b.substring(0,1).toUpperCase()+b.substring(1))}});Rollbar.ItemStatusDropdown=BaseClass.extend({init:function(b){this.$elem=b;var a=this;this.$elem.each(function(){var h=$(this);var c=h.attr("data-itemstatus-url");var d=h.attr("data-itemstatus-current");var g=h.attr("data-itemstatus-refreshsearch")==1;var i=h.attr("data-itemstatus-clearonselect")==1;var f=function(j){h.removeClass("open");d=j;$(".item-status-current-name",h).text(j);$(".btn-item-status",h).each(function(){var k=$(this);if(k.attr("data-itemstatus-name")==j){k.css("font-weight","bold")}else{k.css("font-weight","normal")}});$(".add-comment-container").trigger("reload")};var e=function(j,k){var l=function(n){if(g){$("form#search-form button[type=submit]").click()}else{var m=n.status;f(m)}};$.ajax({type:"POST",url:c,data:{new_status:j,item:k},success:l,dataType:"json"})};$(".btn-item-status",h).click(function(){var m=$(this);var k=m.attr("data-itemstatus-name");var j=$('select.status-ids option[selected="selected"]',m.closest(".item-status-container"));var l=[];j.each(function(){l.push($(this).val())});if(i){$("option",m.closest(".multiselect-controls")).remove()}e(k,l);return false});h.bind("item_status_change",function(k,j){f(j);k.preventDefault();return false});f(d)})}});Rollbar.ItemLevelDropdown=BaseClass.extend({init:function(b){this.$elem=b;var a=this;this.$elem.each(function(){var h=$(this);var e=h.attr("data-itemlevel-url");var g=h.attr("data-itemlevel-current");var f=h.attr("data-itemlevel-refreshsearch")==1;var i=h.attr("data-itemlevel-clearonselect")==1;var d=function(j){h.removeClass("open");g=j;$(".item-level-current-name",h).text(j);$(".btn-item-level",h).each(function(){var k=$(this);if(k.attr("data-itemlevel-name")==j){k.css("font-weight","bold")}else{k.css("font-weight","normal")}})};var c=function(j,k){var l=function(m){if(f){$("form#search-form button[type=submit]").click()}else{var n=m.level;d(n)}};$.ajax({type:"POST",url:e,data:{new_level:j,item:k},success:l,dataType:"json"})};$(".btn-item-level",h).click(function(){var l=$(this);var m=l.attr("data-itemlevel-name");var j=$('select.level-ids option[selected="selected"]',l.closest(".item-level-container"));var k=[];j.each(function(){k.push($(this).val())});if(i){$("option",l.closest(".multiselect-controls")).remove()}c(m,k);return false});h.bind("item_level_change",function(k,j){d(j);k.preventDefault();return false});d(g)})}});Rollbar.AjaxTextboxFormManager=BaseClass.extend({init:function(b){var a=this;this.$elem=b;this.$elem.find(".ajax-textbox-form input[type=text]").blur(function(){var g=$(this).closest(".ajax-textbox-form");var c=g.attr("action");var f=g.attr("method");var d=g.serialize();var e=function(i){var h=$(i.alerts);$("#alerts").append(h);h.each(function(){var j=$(this);setTimeout(function(){j.fadeOut(250)},2000)})};$.ajax({url:c,dataType:"json",data:d,success:e,type:f})})}});Rollbar.AjaxCheckboxFormManager=BaseClass.extend({init:function(b){var a=this;this.$elem=b;this.$elem.click(function(d){var c=$(d.target);if(c.is(".ajax-checkbox-form input[type=checkbox]")){var i=c.closest(".ajax-checkbox-form");var e=i.attr("action");var h=i.attr("method");var f=i.serialize();var g=function(k){var j=$(k.alerts);$("#alerts").append(j);j.each(function(){var l=$(this);setTimeout(function(){l.fadeOut(250)},2000)})};$.ajax({url:e,dataType:"json",data:f,success:g,type:h})}})}});Rollbar.AjaxLoad=BaseClass.extend({init:function(e,d,c,b){this.$elem=b;this.$stage=d;this.$modal=c;this.loadedEventName=e;$(document.body).append(this.$modal);var a=this;this.$elem.each(function(){var k=$(this);var g;var m;var j=k.attr("data-ajaxload-usemodal")||false;var i=k.is("form");var h=k.attr("data-ajaxload-hidefooter")||false;var l=k.hasClass("ajax-load-replace-url");if(i){g=k.attr("action");m=k.attr("method")}else{g=k.attr("href");m="GET"}var f=function(o){var n=k.serialize();var p=function(s){if(l){var w=g+"?"+n;try{history.replaceState({},"",w)}catch(u){}}var v=[];var x=function(){};if(!j){for(var t in s){var r=$("#"+t,a.$stage);r.empty().html(s[t]);v.push(r)}}else{var y=a.$modal;$tmp=$(".modal-body-content",y);$tmp.html(s.partial);v.push($tmp);var q=$(".modal-header-content",$tmp).remove();$(".modal-header-content",y).append(q.html()).show();if(h){$(".modal-footer",y).hide()}else{$(".modal-footer",y).show()}x=function(){y.modal()}}a.$stage.trigger(a.loadedEventName,[v]);x()};$.ajax({url:g,type:m,data:n,success:p,dataType:"json"});o.preventDefault()};if(i){k.submit(f)}else{k.click(f)}})}});Rollbar.Toggle=BaseClass.extend({init:function(a){this.$elem=a;this.$elem.each(function(){var d=$(this);var b=$(".toggle-on",d);var f=$(".toggle-on-ctrl",d);var e=$(".toggle-off",d);var c=$(".toggle-off-ctrl",d);f.click(function(g){b.hide();e.show();g.preventDefault();return false});c.click(function(g){b.show();e.hide();g.preventDefault();return false})})}});d3.selection.prototype.tooltip=function(b){var a,c;a=d3.select("body");c={placement:"right",dx:0,dy:-15};return this.each(function(k,g){var h,f,e,j;e=b.apply(this,arguments);for(f in c){j=c[f];if(!(e[f]!=null)){e[f]=j}}h=d3.select(this);h.on("mouseover",function(){var i,d;i=d3.mouse(a.node());d=a.append("div").attr("class","tooltip fade "+e.placement+" in").style("display","none");d.append("div").html(e.title).attr("class","tooltip-inner");d.append("div").attr("class","tooltip-arrow");return d.style("display","").style("left",""+(i[0]+e.dx)+"px").style("top",""+(i[1]+e.dy)+"px")});h.on("mousemove",function(){var d;d=d3.mouse(a.node());return d3.select(".tooltip").style("left",""+(d[0]+e.dx)+"px").style("top",""+(d[1]+e.dy)+"px")});return h.on("mouseout",function(d){return d3.select(".tooltip").remove()})})};Rollbar.TimeSeriesBarGraph=BaseClass.extend({init:function(a,b){this.svgContainerId=a;this.options=b||{}},draw:function(B,n){var p=$("#"+this.svgContainerId);p.empty();var v=d3.max(B,function(e){return e[1]});if(v==0){var g;var b="No data";try{g=this.options.messages.noData||b}catch(u){g=b}p.append('<div style="padding:60px 0px 0px 0px;"><div class="well" style="text-align:center;margin:0px;">'+g+"</div></div>");return}var o=[25,25,25,50];var i=p.width()-o[1]-o[3];var t=p.height()-o[0]-o[2];var l=function(e){return new Date(e)};var s=d3.time.format("%m/%d/%y %H:%M%p");var j=i/B.length;var f=d3.time.scale().range([0,i]);var d=d3.scale.linear().rangeRound([t,0]);var c=d3.svg.axis().scale(f).orient("bottom");var a=d3.svg.axis().scale(d).orient("left");if(this.options.xAxisTicks){c.ticks(this.options.xAxisTicks)}if(this.options.yAxisTicks){a.ticks(this.options.yAxisTicks)}var k=d3.select("#"+this.svgContainerId).append("svg:svg").attr("width",i+o[1]+o[3]).attr("height",t+o[0]+o[2]).append("svg:g").attr("transform","translate("+o[3]+","+o[0]+")");f.domain([new Date(B[0][0]),new Date(B[B.length-1][0])]);d.domain([0,v]);k.append("svg:g").attr("class","x axis").attr("transform","translate(0,"+t+")").call(c.tickSubdivide(0).tickSize(6));k.append("svg:g").attr("class","y axis").attr("transform","translate(0,0)").call(a.tickSubdivide(0).tickSize(6));var A={placement:"left",dx:-130,dy:-27};if(n){k.selectAll("rect.deploy").data(n.filter(function(e){return f(l(e.start_time))>0})).enter().append("rect").attr("class","deploy").attr("x",function(h,e){return f(l(h.start_time))-0.5}).attr("y",0).attr("width",2).attr("height",t).on("mouseover",function(C,m){var y="Deploy on "+s(l(C.start_time));var x,w;var h=d3.select("body");x=d3.mouse(h.node());w=h.append("div").attr("class","tooltip fade "+A.placement+" in").style("display","none");w.append("div").html(y).attr("class","tooltip-inner");w.append("div").attr("class","tooltip-arrow");return w.style("display","").style("left",""+(x[0]-190)+"px").style("top",""+(x[1]-15)+"px")}).on("mouseout",function(){return d3.select(".tooltip").remove()})}var r=2;var q=d;var d=function(e){return Math.min(q(0)-r,q(e))};var z=this.options.yUnitLabel||"occurrences";k.selectAll("rect.bar").data(B).enter().append("svg:rect").attr("x",function(h,e){return f(l(h[0]))-0.5}).attr("y",function(e){return d(e[1])-0.5}).attr("class","bar").attr("width",j).attr("height",function(e){return t-d(e[1])}).on("mouseover",function(D,m){var w=d3.select(this);w.style("fill","orange");var C=s(new Date(D[0]))+"<br/>"+D[1]+" "+z;var y,x;var h=d3.select("body");y=d3.mouse(h.node());x=h.append("div").attr("class","tooltip fade "+A.placement+" in").style("display","none");x.append("div").html(C).attr("class","tooltip-inner");x.append("div").attr("class","tooltip-arrow");return x.style("display","").style("left",""+(y[0]+A.dx)+"px").style("top",""+(y[1]+A.dy)+"px")}).on("mouseout",function(){d3.select(this).style("fill","steelblue");return d3.select(".tooltip").remove()});k.append("line").attr("x1",0).attr("x2",i+j).attr("y1",t-0.5).attr("y2",t-0.5).style("stroke","#ccc");k.append("line").attr("x1",-0.5).attr("x2",-0.5).attr("y1",0).attr("y2",t).style("stroke","#ccc")}});Rollbar.MultipleCheckboxDropdown=BaseClass.extend({init:function(a){$(".dropdown-menu",a).click(function(b){b.stopPropagation()})}});Rollbar.SearchControls=BaseClass.extend({init:function(a){a.each(function(){var i=$(this);var f=$("form.search-form",i);var h=$(".dropdown-toggle",f);var e=$("button[name=search]",f);var c=$("button[name=refresh]",f);var g=$(".loading",i);var d=false;var b=function(){d=true;setTimeout(function(){if(d){e.text("Searching...");e.addClass("disabled");c.addClass("disabled");h.addClass("disabled");g.removeClass("hidden");d=false}},100);var j=function(){d=false;e.text("Search");e.removeClass("disabled");c.removeClass("disabled");h.removeClass("disabled");g.addClass("hidden");$(document).off("ajaxLoad",j)};$(document).on("ajaxLoad",j);f.submit()};$("input[name=query]",f).keypress(function(j){if(j.keyCode==13){b();return false}});e.click(function(j){b();j.preventDefault()});c.click(function(j){$("input[name=clear_cache]",f).val(1);b();j.preventDefault()});$(".hidden-select",f).click(function(l){var n=$(this);var o=n.closest(".dropdown-select");var k=$(".selector-label",o);var m=$(".last-selected",o);var j=$("input.hidden",n);if(j.attr("checked")){j.removeAttr("checked")}else{$("input.hidden",o).removeAttr("checked");j.attr("checked",true);if(j.val()==""){k.hide()}else{k.show()}m.text(n.text())}n.closest(".activate").toggleClass("active");b()})})}});Rollbar.MultiselectItemList=BaseClass.extend({init:function(e){if(e.length==0){return}var b=$("input.multiselect");var g=$("#multiselectLevel",e);var h=$("#multiselectStatus",e);var d=e.attr("data-multiselect-targets").split(",");var a=$("#"+d.join(",#"));var c=a.closest(".multiselect-controls");$(document).on("ajaxLoad",function(){c.hide()});var f=function(j){a.append($('<option value="'+j+'" selected="selected"></option>'));a.closest(".multiselect-controls").show()};var i=function(j){$("option[value="+j+"]",a).remove();if($("option[selected=selected]",c).length==0){c.hide();e.removeAttr("checked")}};e.click(function(){var j=$(this).attr("checked");if(!j){b.removeAttr("checked")}else{b.attr("checked","checked")}b.change()});b.change(function(j){var l=$(this).attr("data-multiselect-id");var k=$(this).attr("checked");if(k){f(l)}else{i(l)}j.preventDefault()})}});Rollbar.InlineEditableForm=BaseClass.extend({init:function(b){if(b.length==0){return}var a=$(".inline-editable-toggle-edit",b);a.click(function(e){var d=$(e.target);d.closest(".inline-editable").addClass("edit")});var c=$(".inline-editable-toggle-read-only",b);c.click(function(e){var d=$(e.target);d.closest(".inline-editable").removeClass("edit")})}});Rollbar.FeedbackFormManager=BaseClass.extend({init:function(a){if(a.length==0){return}a.click(function(d){var b=$(d.target);if(b.is(".feedback input.feedback-submit")){var e=b.closest("section.feedback");var c=$("form",e);$("input[name=page_url]",c).val(window.location.href);$.ajax({type:"POST",url:c.attr("action"),data:c.serialize(),dataType:"json",success:function(f){if(f.partial){e.replaceWith($(f.partial))}}});d.preventDefault()}});a.keyup(function(c){var b=$(c.target);if(b.is(".feedback textarea.comment")){var d=b.closest("section.feedback");var e=$("input.feedback-submit",d);if(b.val().length==0){e.hide()}else{$(".feedback-response",d).empty();e.show()}c.preventDefault()}})}});